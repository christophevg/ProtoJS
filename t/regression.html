<html>
<head>
  <link rel="stylesheet" type="text/css" href="testing.css" />
  <script type="text/javascript" src="../build/ProtoJS.min.js"></script>
  <script type="text/javascript" src="testing.js"></script>
</head>
<body>
  <h1>Class Based Inheritance</h1>
  <li>Class creation: 
    <script>
    var Class1 = Class.extend( {
      init: function init() {
        this.data = "class1::init";
      },
      aMethod: function aMethod() {
        this.data += "\nclass1::aMethod";
      } 
    });
    var class1Obj = new Class1();
    class1Obj.aMethod();
    test( class1Obj.data, "class1::init\nclass1::aMethod" );
    var Class1b = Class.extend( {
      toString: function toString() {
        return "overridden";
      }
    });
    var class1bObj = new Class1b();
    test( class1bObj.toString(), "overridden" );
    </script>
  </li>
  <li>Inheritance: 
    <script>
    var Class2 = Class1.extend( {
      init: function init() {
        this._super();
        this.data += "\nclass2::init";
      },
      aMethod: function aMethod() {
        this._super();
        this.data += "\nclass2::aMethod";
      } 
    });
    var class2Obj = new Class2();
    class2Obj.aMethod();
    test( class2Obj.data, 
          "class1::init\nclass2::init\nclass1::aMethod\nclass2::aMethod" );
    </script>
  </li>
  <li>2nd degree Inheritance
    <script>
    var Class3 = Class2.extend( {
      init: function init() {
        this._super();
        this.data += "\nclass3::init";
      },
      aMethod: function aMethod() {
        this._super();
        this.data += "\nclass3::aMethod";
      } 
    });
    var class3Obj = new Class3();
    class3Obj.aMethod();
    test( class3Obj.data, 
          "class1::init\nclass2::init\nclass3::init\n" +
          "class1::aMethod\nclass2::aMethod\nclass3::aMethod" );
    </script>
  </li>

  <h1>Array extensions</h1>
  <li><b>has</b> support
    <script>
    var myArray = [ 10, 20, 30, "apple", "ibm" ];
    test( myArray.has( "apple" ), true );
    test( myArray.has( "microsoft" ), false );
    </script>
  </li>
  <li>iterator support
    <script>
    var result = "";
    myArray.iterate( function(part) { result += part; } );
    test( result, "102030appleibm" );
    </script>
  </li>
  <li><b>compare</b> support
    <script>
    test( [ 1, 2, 3 ].compare( [ 1, 2, 3 ] ), true );
    test( [ 1, 2, 3 ].compare( [ 1, 3 ] ), false );
    </script>
  </li>
  <li><b>remove</b> support
    <script>
    test( [ 1, 2, 3, 4, 5 ].remove( 2, 4 ).compare( [ 1, 3, 5 ] ), true );
    </script>
  </li>
  <li><b>clear</b> support
    <script>
    test( [ 1, 2, 3, 4, 5 ].clear().compare([]), true );
    </script>
  </li>
  <li><b>dup</b> support
    <script>
    var x = [ 1, 2, 3 ];
    var y = x.dup();
    test( x != y && x.compare(y), true );
    </script>
  </li>
  <li><b>unique</b> support
    <script>
    test( [ 1, 2, 2, 3, 3 ].unique().compare( [ 1, 2, 3 ] ), true );
    </script>
  </li>
  <li><b>min/max</b> support
    <script>
    test( [ -999, 1, 999].min(), -999 );
    test( [ -999, 1, 999].max(), 999 );
    </script>
  </li>

  <h1>Hash Class extension</h1>
  <li><b>get/set</b> support
    <script>
    var myHash = $H( { a: 10, b:20, c:30, d:"apple", e:"ibm" } );
    myHash.set( "d", "Apple" );
    test( myHash.get( "d" ) == "Apple", true );
    myHash.set( "d", "apple" );
    </script>
  </li>
  <li><b>keys</b> support
    <script>
    test( myHash.keys().toString(), "a,b,c,d,e" );	
    </script>
  </li>
  <li><b>values</b> support
    <script>
    test( myHash.values().toString(), "10,20,30,apple,ibm" );
    </script>
  </li>
  <li><b>hasKey</b> support
    <script>
    test( myHash.hasKey( "c" ), true );
    test( myHash.hasKey( 1 ), false );
    </script>
  </li>
  <li><b>hasValue</b> support
    <script>
    test( myHash.hasValue( "apple" ), true );
    test( myHash.hasValue( 1 ), false );
    </script>
  </li>
  <li>iterator support
    <script>
    var result = "";
    myHash.iterate(function(key, value) { result += key + "=" + value; });
    test( result, "a=10b=20c=30d=applee=ibm" );
    </script>
  </li>

  <h1>Function extensions</h1>
  <li><b>scoping</b> support
    <script>
    var obj = { x: "data",  };
    var f = function() { return this.x; };
    test( f.scope(obj)(), "data" );
    </script>
  </li>
  <li><b>after</b> support
    <span id="wait-result" class="failure">FAIL</span>
    <script>
    var x = function(result) {
      document.getElementById("wait-result").className = "ok";
      document.getElementById("wait-result").innerHTML = result;
    }.after(10, "OK");
    </script>
  </li>

  <h1>Object extensions</h1>
  <li>type checking
    <script>
    // TODO: test ALL combo's ;-)
    test( "123".isString(), true );
    test( Object.isString( "123" ), true );

    test( [ 1, 2, 3 ].isArray(), true );
    test( "123".isArray(), false );

    test( (123).isString(), false );
    test( (123).isNumber(), true );

    test( Object.isArray( [ 1, 2 ] ), true );
    test( Object.isArray( { 1:1, 2:2 } ), false );
    </script>
  </li>

  <h1>String extensions</h1>
  <li><b>contains</b> support
    <script>
    test( "123".contains( "2" ), true );
    </script>
  </li>
  <li><b>containsOneOf</b> support
    <script>
    test( "123".containsOneOf( [ "a", "2", "b" ] ), true );
    test( "123".containsOneOf( [ "a", "b", "c" ] ), false );
    </script>
  </li>
  <li><b>trim</b> support
    <script>
    test( " 123 ".trim(), "123" );
    test( ProtoJS.String.trim( " 123\n\t "), "123");
    </script>
  </li>

  <h1>Ajax support</h1>
  <li>Synchronous <b>fetch</b> support
    <script>
    var data = new ProtoJS.Ajax().fetch( "data.txt" );
    test( data, "123\n" );
    </script>
  </li>
  <li>Asynchronous <b>fetch</b> support
    <span id="ajax-async-result" class="failure">FAIL</span>
    <script>
    new ProtoJS.Ajax().fetch( "data.txt", function(result) {
      if( result.responseText == "123\n" ) {
        document.getElementById("ajax-async-result").className = "ok";
        document.getElementById("ajax-async-result").innerHTML = "OK";
      }
    });
    </script>
  </li>
  <li>Cross-Domain-Request support (our way) 
    <span id="xdr-async-result" class="failure">FAIL</span>
    <script>
    var parts = window.location.pathname.split('/');
    parts.pop();
    var myUrl = window.location.protocol + "//" + 
              window.location.host + parts.join('/');
    new ProtoJS.Ajax().fetch( myUrl + "/data.js", function(result) {
      if( result == "123\n" ) {
        document.getElementById("xdr-async-result").className = "ok";
        document.getElementById("xdr-async-result").innerHTML = "OK";
      }
    });
    </script>
  </li>

  <h1>Timer support</h1>
  <li>Basic usage
    <span id="simple-timer-result" class="failure">testing...</span>
    <script>
      var timer = new ProtoJS.Timer();
      timer.start();
      var x = function() {
        timer.stop();
        if( Math.round(timer.getElapsed() / 100) == 11 ) {
          document.getElementById("simple-timer-result").className = "ok";
          document.getElementById("simple-timer-result").innerHTML = "OK";
        } else {
          document.getElementById("simple-timer-result").innerHTML = "FAIL";
        }
      }.after(1100);
    </script>
  </li>

  <h1>Font support</h1>
  <li>Basic Usage
    <script>
      var font = new ProtoJS.Font( "italic bold 15pt/30px Georgia, serif" );
      test( font.getPtSize(),   15   );
      test( font.getPxSize(),   21   );
      test( font.getEmSize(),    1.3 );
      test( font.getPctSize(), 130   );
    </script>
  </li>
</body>
</html>
